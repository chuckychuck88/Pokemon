<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Pokémon Survival - Pixel Inventory</title>
<style>
  html,body{
    margin:0;padding:0;overflow:hidden;background:#000;
  }
  canvas{
    width:100vw;height:100vh;display:block;
    image-rendering:pixelated;cursor:crosshair;
  }

  /* ✅ Inventory UI */
  #inventoryBox {
    position: fixed;
    top: 20px;
    left: 20px;
    width: 260px;
    height: 180px;
    background: url("assets/inventory.png") no-repeat center/contain;
    color: #fff9d9;
    font-family: monospace;
    padding: 30px 15px 10px 15px;
    box-sizing: border-box;
    font-size: 16px;
    line-height: 22px;
    text-shadow: 1px 1px 2px #000;
  }
  #inventoryBox h3 {
    text-align: center;
    margin: 0 0 10px 0;
    font-size: 18px;
    color: #ffe7a3;
  }

  /* ✅ Crafting UI */
  #craftingUI {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(20,20,20,0.95);
    border: 2px solid #fff;
    color: white;
    font-family: monospace;
    padding: 20px;
    display: none;
    z-index: 10;
    width: 300px;
    text-align: center;
  }
  #craftingUI button {
    display: block;
    margin: 10px auto;
    background: #3a3a3a;
    border: 1px solid #fff;
    color: white;
    padding: 6px 10px;
    cursor: pointer;
  }
  #craftingUI button:hover {
    background: #5a5a5a;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>

<!-- ✅ Inventory UI -->
<div id="inventoryBox">
  <h3>Inventory</h3>
  <div id="invList"></div>
</div>

<!-- ✅ Crafting UI -->
<div id="craftingUI">
  <h2>Crafting</h2>
  <div id="craftList"></div>
  <p style="color:gray;">Press [C] to close</p>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d",{alpha:true});
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
resize();addEventListener("resize",resize);

// ====== Assets ======
const playerImg=new Image();playerImg.src="assets/player.png";
const stoneImg=new Image();stoneImg.src="assets/stone.png";

// ====== Game Data ======
const player={x:0,y:0,speed:4};
let inventory={wood:0,stone:0,axe:false,pickaxe:false};
const trees=[],stones=[];

// ====== Background Grass ======
const grass=document.createElement("canvas");
grass.width=64;grass.height=64;
const gctx=grass.getContext("2d");
gctx.fillStyle="#3aa63f";gctx.fillRect(0,0,64,64);
gctx.fillStyle="#2e8b34";
for(let i=0;i<80;i++)gctx.fillRect(Math.random()*64,Math.random()*64,3,3);
const pattern=ctx.createPattern(grass,"repeat");

// ====== Object Generation ======
for(let i=0;i<40;i++)
  trees.push({x:Math.random()*4000-2000,y:Math.random()*4000-2000,size:64,health:3,breaking:false});
for(let i=0;i<25;i++)
  stones.push({x:Math.random()*4000-2000,y:Math.random()*4000-2000,size:64,health:3,breaking:false});

// ====== Controls ======
const keys={};
onkeydown=e=>{
  keys[e.key.toLowerCase()]=true;
  if(e.key.toLowerCase()==="c") toggleCrafting();
};
onkeyup=e=>keys[e.key.toLowerCase()]=false;
canvas.addEventListener("click",handleClick);

// ====== Click to Break ======
function handleClick(e){
  if(craftingOpen) return;

  const mx=e.offsetX-canvas.width/2+player.x;
  const my=e.offsetY-canvas.height/2+player.y;
  let target=null;
  [...trees,...stones].forEach(obj=>{
    const dist=Math.hypot(obj.x-mx,obj.y-my);
    if(dist<60 && !target) target=obj;
  });

  if(target){
    target.breaking=true;
    const breakSpeed = (inventory.axe && trees.includes(target)) || (inventory.pickaxe && stones.includes(target)) ? 150 : 300;
    setTimeout(()=>{
      target.health--;
      if(target.health<=0){
        if(trees.includes(target)){
          trees.splice(trees.indexOf(target),1);
          const amt=Math.floor(Math.random()*2)+2;
          inventory.wood+=amt;
          popup("+ "+amt+" wood",target.x,target.y,"#d0a050");
        }else if(stones.includes(target)){
          stones.splice(stones.indexOf(target),1);
          const amt=Math.floor(Math.random()*2)+2;
          inventory.stone+=amt;
          popup("+ "+amt+" stone",target.x,target.y,"#c0c0c0");
        }
        updateInventoryBox();
      }
      target.breaking=false;
    },breakSpeed);
  }
}

// ====== Pop-up Text ======
const popups=[];
function popup(txt,x,y,color){popups.push({txt,x,y,color,life:60});}

// ====== Draw Tree ======
function drawTree(g,x,y,size,breaking){
  g.save();
  if(breaking) g.translate(x+Math.random()*4-2,y+Math.random()*4-2);
  else g.translate(x,y);
  g.fillStyle="#5c3b1e";g.fillRect(size/2-5,size-18,10,18);
  for(let i=0;i<3;i++){
    const baseY=size/2-i*12;
    const shade=i===0?"#4cd155":i===1?"#38b044":"#2a8b34";
    g.fillStyle=shade;
    g.beginPath();
    g.moveTo(0,baseY);
    g.lineTo(size,baseY);
    g.lineTo(size/2,baseY-14);
    g.closePath();g.fill();
  }
  g.restore();
}

// ====== Crafting System ======
let craftingOpen=false;
const craftingUI=document.getElementById("craftingUI");
const craftList=document.getElementById("craftList");

const recipes=[
  {name:"Axe", requires:{wood:3,stone:2}, gives:"axe"},
  {name:"Pickaxe", requires:{wood:2,stone:3}, gives:"pickaxe"},
];

function toggleCrafting(){
  craftingOpen=!craftingOpen;
  craftingUI.style.display=craftingOpen?"block":"none";
  if(craftingOpen) buildCraftingList();
}

function buildCraftingList(){
  craftList.innerHTML="";
  recipes.forEach(r=>{
    const btn=document.createElement("button");
    btn.textContent=`Craft ${r.name} (${r.requires.wood} wood, ${r.requires.stone} stone)`;
    btn.onclick=()=>{
      if(inventory.wood>=r.requires.wood && inventory.stone>=r.requires.stone){
        inventory.wood-=r.requires.wood;
        inventory.stone-=r.requires.stone;
        inventory[r.gives]=true;
        popup(`Crafted ${r.name}!`, player.x, player.y, "#ffb000");
        updateInventoryBox();
        toggleCrafting();
      } else {
        alert("Not enough materials!");
      }
    };
    craftList.appendChild(btn);
  });
}

// ====== Update Inventory Text ======
function updateInventoryBox(){
  const invList=document.getElementById("invList");
  invList.innerHTML="";
  const items=[];
  items.push(`Wood (${inventory.wood})`);
  items.push(`Stone (${inventory.stone})`);
  if(inventory.axe) items.push("Axe (crafted)");
  if(inventory.pickaxe) items.push("Pickaxe (crafted)");
  items.forEach(i=>{
    const p=document.createElement("div");
    p.textContent=i;
    invList.appendChild(p);
  });
}

// ====== Game Loop ======
function loop(){
  if(!craftingOpen){
    let dx=0,dy=0;
    if(keys["w"]||keys["arrowup"])dy-=player.speed;
    if(keys["s"]||keys["arrowdown"])dy+=player.speed;
    if(keys["a"]||keys["arrowleft"])dx-=player.speed;
    if(keys["d"]||keys["arrowright"])dx+=player.speed;
    player.x+=dx;player.y+=dy;
  }

  ctx.fillStyle=pattern;
  ctx.save();
  ctx.translate(canvas.width/2-player.x,canvas.height/2-player.y);
  ctx.fillRect(player.x-canvas.width,player.y-canvas.height,canvas.width*2,canvas.height*2);
  ctx.imageSmoothingEnabled=false;

  for(const t of trees) drawTree(ctx,t.x-32,t.y-64,t.size,t.breaking);
  for(const s of stones){
    ctx.save();
    if(s.breaking) ctx.translate(s.x+Math.random()*4-2,s.y+Math.random()*4-2);
    else ctx.translate(s.x,s.y);
    if(stoneImg.complete) ctx.drawImage(stoneImg,-s.size/2,-s.size/2,s.size,s.size);
    ctx.restore();
  }

  if(playerImg.complete)
    ctx.drawImage(playerImg,player.x-32,player.y-32,64,64);
  else{
    ctx.fillStyle="yellow";ctx.fillRect(player.x-24,player.y-24,48,48);
  }

  for(let i=popups.length-1;i>=0;i--){
    const p=popups[i];
    ctx.fillStyle=p.color;
    ctx.font="20px monospace";
    ctx.fillText(p.txt,p.x,p.y-p.life/2);
    p.life--; if(p.life<=0)popups.splice(i,1);
  }

  ctx.restore();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
