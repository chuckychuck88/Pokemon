<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Pok√©mon Survival Infinite</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#000;font-family:monospace;}
canvas{width:100vw;height:100vh;display:block;image-rendering:pixelated;cursor:crosshair;}
#inventoryBox{
  position:fixed;
  right:20px;
  top:20px;
  background:rgba(80,50,20,0.9);
  color:#fff;
  padding:10px 16px;
  border:2px solid #a87a3a;
  border-radius:6px;
  min-width:180px;
  font-size:18px;
}
#craftingUI{
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:rgba(50,30,10,0.95);
  color:#fff;
  border:2px solid #b8824d;
  padding:20px;
  border-radius:8px;
  display:none;
}
#craftingUI button{
  display:block;
  margin:8px 0;
  width:100%;
  font-size:18px;
  background:#c49752;
  color:#fff;
  border:none;
  padding:8px;
  border-radius:4px;
  cursor:pointer;
}
</style>
</head>
<body>
<canvas id="game"></canvas>

<div id="inventoryBox">
  <b>Inventory</b>
  <div id="invList">Wood (0)<br>Stone (0)</div>
</div>

<div id="craftingUI">
  <h2>Crafting</h2>
  <div id="craftList"></div>
  <p style="color:gray;">Press [C] to close</p>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d",{alpha:true});
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
resize();addEventListener("resize",resize);

// ====== Assets ======
const playerImg=new Image();playerImg.src="assets/player.png";
const stoneImg=new Image();stoneImg.src="assets/stone.png";
const berryImg=new Image();berryImg.src="assets/berry.png";

// ====== Player & Inventory ======
const player={x:0,y:0,speed:4};
let inventory={wood:0,stone:0,axe:false,pickaxe:false,berry:0};
let equipped=null;
let health=100;
let hunger=100;

// ====== Dynamic Resources ======
let trees=[], stones=[], berries=[];

function spawnNearbyResources(){
  const radius=800;
  while(trees.length<30){
    const x=player.x+(Math.random()*radius*2-radius);
    const y=player.y+(Math.random()*radius*2-radius);
    trees.push({x,y,size:64,health:3,breaking:false});
  }
  while(stones.length<20){
    const x=player.x+(Math.random()*radius*2-radius);
    const y=player.y+(Math.random()*radius*2-radius);
    stones.push({x,y,size:64,health:3,breaking:false});
  }
  while(berries.length<15){
    const x=player.x+(Math.random()*radius*2-radius);
    const y=player.y+(Math.random()*radius*2-radius);
    berries.push({x,y,size:48});
  }

  // Remove far-away objects
  trees=trees.filter(t=>Math.hypot(t.x-player.x,t.y-player.y)<1000);
  stones=stones.filter(s=>Math.hypot(s.x-player.x,s.y-player.y)<1000);
  berries=berries.filter(b=>Math.hypot(b.x-player.x,b.y-player.y)<1000);
}

// ====== Grass background ======
const grass=document.createElement("canvas");
grass.width=64; grass.height=64;
const gctx=grass.getContext("2d");
gctx.fillStyle="#3aa63f"; gctx.fillRect(0,0,64,64);
gctx.fillStyle="#2e8b34";
for(let i=0;i<80;i++) gctx.fillRect(Math.random()*64,Math.random()*64,3,3);
const pattern=ctx.createPattern(grass,"repeat");

// ====== Controls ======
const keys={};
onkeydown=e=>{
  keys[e.key.toLowerCase()]=true;
  if(e.key.toLowerCase()==="c") toggleCrafting();
  if(e.key.toLowerCase()==="e") eatBerry();
  handleEquipKeys(e.key);
};
onkeyup=e=>keys[e.key.toLowerCase()]=false;
canvas.addEventListener("click",handleClick);

// ====== Equip Keys ======
function handleEquipKeys(key){
  if(key==="1" && inventory.axe){
    if(equipped==="axe"){equipped=null;popup("Unequipped Axe",player.x,player.y,"#fff");}
    else {equipped="axe";popup("Equipped Axe",player.x,player.y,"#ffc04c");}
    updateInventoryBox();
  }
  if(key==="2" && inventory.pickaxe){
    if(equipped==="pickaxe"){equipped=null;popup("Unequipped Pickaxe",player.x,player.y,"#fff");}
    else {equipped="pickaxe";popup("Equipped Pickaxe",player.x,player.y,"#b0e0ff");}
    updateInventoryBox();
  }
}

// ====== Click to Break / Pick Berries ======
function handleClick(e){
  if(craftingOpen) return;
  const mx=e.offsetX-canvas.width/2+player.x;
  const my=e.offsetY-canvas.height/2+player.y;

  // Berry pickup
  for(let i=berries.length-1;i>=0;i--){
    const b=berries[i];
    if(Math.hypot(b.x-mx,b.y-my)<40){
      berries.splice(i,1);
      const amt=Math.floor(Math.random()*2)+1;
      inventory.berry+=amt;
      popup("+ "+amt+" berry",b.x,b.y,"#ff4c4c");
      updateInventoryBox();
      return;
    }
  }

  // Trees / Stones
  let target=null;
  [...trees,...stones].forEach(obj=>{
    const dist=Math.hypot(obj.x-mx,obj.y-my);
    if(dist<60 && !target) target=obj;
  });

  if(target){
    target.breaking=true;
    let breakSpeed=300;
    if(equipped==="axe" && trees.includes(target)) breakSpeed=150;
    if(equipped==="pickaxe" && stones.includes(target)) breakSpeed=150;

    setTimeout(()=>{
      target.health--;
      if(target.health<=0){
        if(trees.includes(target)){
          trees.splice(trees.indexOf(target),1);
          let amt=Math.floor(Math.random()*2)+2;
          // Axe bonus
          if(equipped==="axe"){
            if(Math.random()<0.3) amt+=1;
            if(Math.random()<0.1) amt+=2;
          }
          inventory.wood+=amt;
          popup("+ "+amt+" wood",target.x,target.y,"#d0a050");
        }else if(stones.includes(target)){
          stones.splice(stones.indexOf(target),1);
          let amt=Math.floor(Math.random()*2)+2;
          // Pickaxe bonus
          if(equipped==="pickaxe"){
            if(Math.random()<0.3) amt+=1;
            if(Math.random()<0.1) amt+=2;
          }
          inventory.stone+=amt;
          popup("+ "+amt+" stone",target.x,target.y,"#c0c0c0");
        }
        updateInventoryBox();
      }
      target.breaking=false;
    },breakSpeed);
  }
}

// ====== Eat Berry ======
function eatBerry(){
  if(inventory.berry>0){
    inventory.berry--;
    hunger=Math.min(100,hunger+20);
    health=Math.min(100,health+10);
    popup("You ate a berry!",player.x,player.y,"#ff5c5c");
    updateInventoryBox();
  }else popup("No berries!",player.x,player.y,"#ccc");
}

// ====== Popup System ======
const popups=[];
function popup(txt,x,y,color){popups.push({txt,x,y,color,life:60});}

// ====== Draw Tree ======
function drawTree(g,x,y,size,breaking){
  g.save();
  if(breaking) g.translate(x+Math.random()*4-2,y+Math.random()*4-2);
  else g.translate(x,y);
  g.fillStyle="#5c3b1e";g.fillRect(size/2-5,size-18,10,18);
  for(let i=0;i<3;i++){
    const baseY=size/2-i*12;
    const shade=i===0?"#4cd155":i===1?"#38b044":"#2a8b34";
    g.fillStyle=shade;
    g.beginPath();
    g.moveTo(0,baseY);
    g.lineTo(size,baseY);
    g.lineTo(size/2,baseY-14);
    g.closePath();g.fill();
  }
  g.restore();
}

// ====== Crafting ======
let craftingOpen=false;
const craftingUI=document.getElementById("craftingUI");
const craftList=document.getElementById("craftList");
const recipes=[
  {name:"Axe",requires:{wood:3,stone:2},gives:"
